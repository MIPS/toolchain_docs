# Referring to the GP in code sequences

Both GP-relative and GOT-dependent addressing refer to the GP (Global Pointer)
in their code sequences and need to have the address of the GP loaded into
the `$gp` register.

For GOT-dependent addressing, the `$gp` needs to be explicitly set up in every
function which uses it and can be called from a module which has a different
GOT, and thus a different value for GP.
It does not need to be set up if the function is local, all of its callers are
local, and all of its callers are guaranteed to have a correct `$gp`.

For GP-relative addressing, the `$gp` only needs to be set up before entering
main(). This is an implicit setup of `$gp`.
Note that combining these two addressing modes will make it necessary to
explicitly set up `$gp` in a function which can be called externally, even if
that function contains only GP-relative sequences.

The implicit setup is part of library code, while the explicit setup is
generated by the compiler. The code sequence for the explicit setup is just a
regular PC-relative address calculation, while the implicit setup sequence is
restricted to LAPC.B (i.e. ADDIUPC[48]), as this prevents us from relying on
linker transformations for critical library code (e.g. the crt, etc.) and
frees us from being boxed in by the limitations of absolute addressing.

The GP does not have any special alignment requirements. This gives the linker
more flexibility in determining the data layout of the application.

Note that the `$gp` register is callee-saved, so it needs to be saved and
restored before returning in every function which uses it.
